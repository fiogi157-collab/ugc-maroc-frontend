<!doctype html>
<html dir="rtl" lang="ar">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>تسجيل الدخول كمبدع - UGC Maroc</title>
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
            rel="stylesheet"
        />
        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            primary: "#5b13ec",
                            "background-light": "#f6f6f8",
                            "background-dark": "#161022",
                        },
                        fontFamily: {
                            display: [
                                "Manrope",
                                "Noto Sans Kufi Arabic",
                                "sans-serif",
                            ],
                        },
                        borderRadius: {
                            DEFAULT: "0.25rem",
                            lg: "0.5rem",
                            xl: "0.75rem",
                            full: "9999px",
                        },
                    },
                },
            };
        </script>
        <link href="https://fonts.googleapis.com" rel="preconnect" />
        <link
            crossorigin=""
            href="https://fonts.gstatic.com"
            rel="preconnect"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&amp;family=Noto+Sans+Kufi+Arabic:wght@400;500;700&amp;display=swap"
            rel="stylesheet"
        />
        <style>
            body {
                font-family: "Manrope", "Noto Sans Kufi Arabic", sans-serif;
            }
            .form-input.invalid {
                border-color: #ef4444;
            }
            .form-input.valid {
                border-color: #22c55e;
            }
            .form-input.invalid:focus {
                --tw-ring-color: #ef4444;
                border-color: #ef4444;
            }
            .form-input.valid:focus {
                --tw-ring-color: #22c55e;
                border-color: #22c55e;
            }
        </style>
    </head>
    <body
        class="bg-background-light dark:bg-background-dark font-display text-slate-800 dark:text-slate-200"
    >
        <div class="flex flex-col min-h-screen">
            <header
                class="bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm sticky top-0 z-20"
            >
                <nav
                    class="container mx-auto px-6 py-4 flex justify-between items-center"
                >
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 text-primary">
                            <svg
                                fill="none"
                                viewBox="0 0 48 48"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M42.4379 44C42.4379 44 36.0744 33.9038 41.1692 24C46.8624 12.9336 42.2078 4 42.2078 4L7.01134 4C7.01134 4 11.6577 12.932 5.96912 23.9969C0.876273 33.9029 7.27094 44 7.27094 44L42.4379 44Z"
                                    fill="currentColor"
                                ></path>
                            </svg>
                        </div>
                        <h1
                            class="text-xl font-bold text-slate-900 dark:text-white"
                        >
                            UGC Maroc
                        </h1>
                    </div>
                    <div class="flex items-center gap-4">
                        <a
                            class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-primary transition-colors"
                            href="/auth/brand-login.html"
                            >تسجيل دخول العلامات التجارية</a
                        >
                        <a
                            class="text-sm font-medium text-primary hover:text-primary/80"
                            href="/auth/creator-signup.html"
                            >إنشاء حساب</a
                        >
                    </div>
                </nav>
            </header>
            <main
                class="flex-grow flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
            >
                <div class="w-full max-w-md space-y-8">
                    <div>
                        <h2
                            class="text-center text-3xl font-bold text-slate-900 dark:text-white"
                        >
                            مرحباً بعودتك، أيها المبدع!
                        </h2>
                        <p
                            class="mt-2 text-center text-sm text-slate-600 dark:text-slate-400"
                        >
                            سجل دخولك الآن لتبدأ رحلتك في عالم الإبداع والفرص.
                        </p>
                    </div>
                    <div
                        class="p-8 sm:p-10 bg-background-light dark:bg-background-dark/50 rounded-xl shadow-lg"
                    >
                        <div
                            class="hidden mb-4 p-4 rounded-lg text-sm"
                            id="alert-container"
                        ></div>
                        <form
                            onsubmit="handleLogin(event)"
                            action="#"
                            class="space-y-6"
                            id="login-form"
                            method="POST"
                        >
                            <div>
                                <label class="sr-only" for="email-address"
                                    >البريد الإلكتروني/اسم المستخدم</label
                                >
                                <div class="relative">
                                    <input
                                        autocomplete="email"
                                        class="appearance-none rounded-lg relative block w-full px-3 py-3 border border-slate-300 dark:border-slate-700 placeholder-slate-500 dark:placeholder-slate-400 text-slate-900 dark:text-white bg-background-light dark:bg-background-dark focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm form-input"
                                        id="email-address"
                                        name="email"
                                        placeholder="البريد الإلكتروني أو اسم المستخدم"
                                        required=""
                                        type="email"
                                    />
                                    <span
                                        class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400 pointer-events-none"
                                    >
                                        <svg
                                            aria-hidden="true"
                                            class="h-5 w-5"
                                            fill="currentColor"
                                            viewBox="0 0 20 20"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <path
                                                d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"
                                            ></path>
                                            <path
                                                d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"
                                            ></path>
                                        </svg>
                                    </span>
                                </div>
                                <p
                                    class="mt-2 text-xs text-red-500 hidden"
                                    id="email-error"
                                ></p>
                            </div>
                            <div>
                                <label class="sr-only" for="password"
                                    >كلمة المرور</label
                                >
                                <div class="relative">
                                    <input
                                        autocomplete="current-password"
                                        class="appearance-none rounded-lg relative block w-full px-3 py-3 border border-slate-300 dark:border-slate-700 placeholder-slate-500 dark:placeholder-slate-400 text-slate-900 dark:text-white bg-background-light dark:bg-background-dark focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm form-input"
                                        id="password"
                                        name="password"
                                        placeholder="كلمة المرور"
                                        required=""
                                        type="password"
                                    />
                                    <button
                                        class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"
                                        id="togglePassword"
                                        type="button"
                                    >
                                        <span
                                            class="material-symbols-outlined h-5 w-5"
                                            id="eye-icon"
                                            >visibility_off</span
                                        >
                                    </button>
                                </div>
                                <p
                                    class="mt-2 text-xs text-red-500 hidden"
                                    id="password-error"
                                ></p>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input
                                        class="h-4 w-4 text-primary bg-slate-200 dark:bg-slate-700 border-slate-300 dark:border-slate-600 focus:ring-primary rounded"
                                        id="remember-me"
                                        name="remember-me"
                                        type="checkbox"
                                    />
                                    <label
                                        class="mr-2 block text-sm text-slate-900 dark:text-slate-300"
                                        for="remember-me"
                                        >تذكرني</label
                                    >
                                </div>
                                <div class="text-sm">
                                    <a
                                        class="font-medium text-primary hover:text-primary/80"
                                        href="/auth/forgot-password.html"
                                    >
                                        نسيت كلمة المرور؟
                                    </a>
                                </div>
                            </div>
                            <div>
                                <button
                                    class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background-light dark:focus:ring-offset-background-dark focus:ring-primary transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                    id="login-button"
                                    type="submit"
                                >
                                    <span
                                        class="absolute right-0 inset-y-0 flex items-center pr-3"
                                    >
                                        <svg
                                            class="h-5 w-5 text-primary-300 group-hover:text-primary-400 hidden animate-spin"
                                            fill="none"
                                            id="loader"
                                            viewBox="0 0 24 24"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <circle
                                                class="opacity-25"
                                                cx="12"
                                                cy="12"
                                                r="10"
                                                stroke="currentColor"
                                                stroke-width="4"
                                            ></circle>
                                            <path
                                                class="opacity-75"
                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                                fill="currentColor"
                                            ></path>
                                        </svg>
                                    </span>
                                    <span id="button-text">تسجيل الدخول</span>
                                </button>
                            </div>
                        </form>
                    </div>
                    <div
                        class="text-center text-sm text-slate-600 dark:text-slate-400"
                    >
                        <p>
                            ليس لديك حساب؟
                            <a
                                class="font-medium text-primary hover:text-primary/80"
                                href="/auth/creator-signup.html"
                            >
                                سجل كمبدع
                            </a>
                        </p>
                    </div>
                </div>
            </main>
        </div>
        <!-- Scripts UGC Maroc - Workers API -->
        <script src="/js/config.js"></script>
        <script src="/js/utils.js"></script>
        <script src="/js/auth-workers.js"></script>
        <script src="/js/api-workers.js"></script>
        <script src="/js/main.js"></script>
        
        <script>
            // Toggle password visibility
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eye-icon');
            
            if (togglePassword) {
                togglePassword.addEventListener('click', () => {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    eyeIcon.textContent = type === 'password' ? 'visibility_off' : 'visibility';
                });
            }
            
            // Get error elements at the top level
            const emailError = document.getElementById('email-error');
            const passwordError = document.getElementById('password-error');
            
            const validateEmail = () => {
                const emailInput = document.getElementById('email-address');
                if (!emailInput.value) {
                    emailInput.classList.add('invalid');
                    emailInput.classList.remove('valid');
                    emailError.textContent = 'البريد الإلكتروني أو اسم المستخدم مطلوب.';
                    emailError.classList.remove('hidden');
                    return false;
                } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value) && !/^[a-zA-Z0-9_]{3,}$/.test(emailInput.value)) {
                    emailInput.classList.add('invalid');
                    emailInput.classList.remove('valid');
                    emailError.textContent = 'الرجاء إدخال بريد إلكتروني أو اسم مستخدم صحيح.';
                    emailError.classList.remove('hidden');
                    return false;
                } else {
                    emailInput.classList.remove('invalid');
                    emailInput.classList.add('valid');
                    emailError.classList.add('hidden');
                    return true;
                }
            };
            const validatePassword = () => {
                if (!passwordInput.value) {
                    passwordInput.classList.add('invalid');
                    passwordInput.classList.remove('valid');
                    passwordError.textContent = 'كلمة المرور مطلوبة.';
                    passwordError.classList.remove('hidden');
                    return false;
                } else if (passwordInput.value.length < 8) {
                    passwordInput.classList.add('invalid');
                    passwordInput.classList.remove('valid');
                    passwordError.textContent = 'يجب أن تكون كلمة المرور 8 أحرف على الأقل.';
                    passwordError.classList.remove('hidden');
                    return false;
                } else {
                    passwordInput.classList.remove('invalid');
                    passwordInput.classList.add('valid');
                    passwordError.classList.add('hidden');
                    return true;
                }
            };
            
            // Fonction de connexion
            async function handleLogin(event) {
                event.preventDefault();
                
                const emailInput = document.getElementById('email-address');
                const alertContainer = document.getElementById('alert-container');
                const loginButton = document.getElementById('login-button');
                const buttonText = document.getElementById('button-text');
                const buttonLoader = loginButton.querySelector('.loading-indicator');
                
                // Validation
                const isEmailValid = validateEmail();
                const isPasswordValid = validatePassword();
                
                if (!isEmailValid || !isPasswordValid) {
                    return;
                }
                
                // Afficher le loading
                loginButton.disabled = true;
                if (buttonText) buttonText.textContent = 'جارٍ تسجيل الدخول...';
                if (buttonLoader) buttonLoader.classList.remove('hidden');
                
                try {
                    const email = emailInput.value.trim();
                    const password = passwordInput.value;
                    
                    const result = await window.auth.loginUser(email, password);
                    
                    if (result.success) {
                        // Succès
                        alertContainer.textContent = 'تم تسجيل الدخول بنجاح! جارٍ التحويل...';
                        alertContainer.className = 'mb-4 p-4 rounded-lg text-sm bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                        alertContainer.classList.remove('hidden');
                        
                        // Redirection vers le dashboard créateur
                        setTimeout(() => {
                            window.location.href = '/creator/creator_dashboard.html';
                        }, 1000);
                    } else {
                        // Erreur
                        alertContainer.textContent = result.error || 'البريد الإلكتروني أو كلمة المرور غير صحيحة.';
                        alertContainer.className = 'mb-4 p-4 rounded-lg text-sm bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
                        alertContainer.classList.remove('hidden');
                        
                        loginButton.disabled = false;
                        if (buttonText) buttonText.textContent = 'تسجيل الدخول';
                        if (buttonLoader) buttonLoader.classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Erreur login:', error);
                    alertContainer.textContent = 'حدث خطأ أثناء تسجيل الدخول. حاول مرة أخرى.';
                    alertContainer.className = 'mb-4 p-4 rounded-lg text-sm bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
                    alertContainer.classList.remove('hidden');
                    
                    loginButton.disabled = false;
                    if (buttonText) buttonText.textContent = 'تسجيل الدخول';
                    if (buttonLoader) buttonLoader.classList.add('hidden');
                }
            }
        </script>
        <script src="/js/nav-links.js"></script>
    
  <!-- Cookie System Integration -->
  <script src="/js/cookie-manager.js"></script>
  <script src="/js/cookie-banner.js"></script>
  <script src="/js/cookie-integration.js"></script>
</body>
</html>
