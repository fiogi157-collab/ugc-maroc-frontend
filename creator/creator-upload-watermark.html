<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رفع الفيديو - UGC Maroc</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .watermark-info {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900">رفع الفيديو</h1>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <span class="text-sm text-gray-500">مرحباً، المبدع</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Watermark Info Panel -->
        <div class="watermark-info rounded-lg p-4 mb-6">
            <div class="flex items-start space-x-3 space-x-reverse">
                <span class="material-symbols-outlined text-amber-600 text-2xl">security</span>
                <div>
                    <h3 class="font-bold text-amber-900 mb-2">🔒 نظام الحماية المزدوج</h3>
                    <p class="text-sm text-amber-800 mb-2">
                        فيديوك سيكون محمياً بعلامة مائية "PREVIEW" حتى موافقة العلامة التجارية وتأكيد الدفع
                    </p>
                    <ul class="text-xs text-amber-700 space-y-1">
                        <li>• العلامة المائية تمنع سرقة المحتوى قبل الدفع</li>
                        <li>• بعد الموافقة والدفع، العلامة المائية تختفي تلقائياً</li>
                        <li>• العلامة التجارية تحتفظ بحقوق النشر على الفيديو النهائي</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">رفع فيديو جديد</h2>
            
            <!-- Campaign Selection -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">اختر الحملة</label>
                <select id="campaignSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">اختر حملة...</option>
                    <option value="1">حملة منتجات التجميل - Marjane</option>
                    <option value="2">حملة الأزياء - Zara</option>
                    <option value="3">حملة الطعام - McDonald's</option>
                </select>
            </div>

            <!-- Video Upload Area -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">رفع الفيديو</label>
                <div id="uploadArea" class="upload-area rounded-lg p-8 text-center cursor-pointer">
                    <div class="space-y-4">
                        <span class="material-symbols-outlined text-4xl text-gray-400">cloud_upload</span>
                        <div>
                            <p class="text-lg font-medium text-gray-900">اسحب وأفلت الفيديو هنا</p>
                            <p class="text-sm text-gray-500">أو انقر للاختيار من الجهاز</p>
                        </div>
                        <div class="text-xs text-gray-400">
                            <p>الصيغ المدعومة: MP4, MOV, AVI</p>
                            <p>الحجم الأقصى: 500 MB</p>
                        </div>
                    </div>
                    <input type="file" id="videoFile" accept="video/*" class="hidden">
                </div>
            </div>

            <!-- Video Preview -->
            <div id="videoPreview" class="mb-6 hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">معاينة الفيديو</label>
                <div class="relative">
                    <video id="previewVideo" class="w-full h-64 bg-gray-100 rounded-lg" controls>
                        متصفحك لا يدعم تشغيل الفيديو
                    </video>
                    <div class="absolute top-2 right-2 bg-red-600 text-white px-2 py-1 rounded text-xs font-bold">
                        PREVIEW
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-2">
                    ⚠️ هذا ما ستراه العلامة التجارية (مع العلامة المائية) حتى الموافقة
                </p>
            </div>

            <!-- Upload Progress -->
            <div id="uploadProgress" class="mb-6 hidden">
                <div class="bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p id="progressText" class="text-sm text-gray-600 mt-2">جاري الرفع...</p>
            </div>

            <!-- Upload Button -->
            <div class="flex justify-end space-x-4 space-x-reverse">
                <button id="uploadBtn" onclick="uploadVideo()" 
                        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled>
                    رفع الفيديو
                </button>
            </div>
        </div>

        <!-- Recent Submissions -->
        <div class="mt-8">
            <h3 class="text-lg font-bold text-gray-900 mb-4">تقديماتي الأخيرة</h3>
            <div class="grid gap-4 md:grid-cols-2">
                <!-- Submission 1 -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-gray-900">فيديو تجميل - آمنة</h4>
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">في المراجعة</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">حملة: منتجات التجميل</p>
                    <div class="text-xs text-gray-500">
                        <p>🔒 محمي بعلامة مائية حتى الموافقة</p>
                        <p>تم الرفع: منذ ساعتين</p>
                    </div>
                </div>

                <!-- Submission 2 -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-gray-900">فيديو أزياء - فاطمة</h4>
                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">موافق</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">حملة: الأزياء الصيفية</p>
                    <div class="text-xs text-gray-500">
                        <p>✅ تمت الموافقة وإزالة العلامة المائية</p>
                        <p>تم الرفع: منذ يوم</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let selectedCampaign = null;

        // Initialize upload area
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('videoFile');
            const campaignSelect = document.getElementById('campaignSelect');

            // Click to select file
            uploadArea.addEventListener('click', () => fileInput.click());

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            // Campaign selection
            campaignSelect.addEventListener('change', (e) => {
                selectedCampaign = e.target.value;
                updateUploadButton();
            });
        });

        function handleFileSelect(file) {
            if (!file.type.startsWith('video/')) {
                alert('يرجى اختيار ملف فيديو صالح');
                return;
            }

            if (file.size > 500 * 1024 * 1024) { // 500MB
                alert('حجم الملف كبير جداً. الحد الأقصى 500 MB');
                return;
            }

            selectedFile = file;
            showVideoPreview(file);
            updateUploadButton();
        }

        function showVideoPreview(file) {
            const previewDiv = document.getElementById('videoPreview');
            const previewVideo = document.getElementById('previewVideo');
            
            const url = URL.createObjectURL(file);
            previewVideo.src = url;
            previewDiv.classList.remove('hidden');
        }

        function updateUploadButton() {
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = !selectedFile || !selectedCampaign;
        }

        async function uploadVideo() {
            if (!selectedFile || !selectedCampaign) {
                alert('يرجى اختيار الفيديو والحملة');
                return;
            }

            const formData = new FormData();
            formData.append('video', selectedFile);
            formData.append('campaignId', selectedCampaign);
            formData.append('campaignName', document.getElementById('campaignSelect').selectedOptions[0].text);

            // Show progress
            const progressDiv = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressDiv.classList.remove('hidden');
            progressBar.style.width = '0%';
            progressText.textContent = 'جاري الرفع...';

            try {
                const response = await fetch('/api/upload-video', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    progressBar.style.width = '100%';
                    progressText.textContent = 'تم الرفع بنجاح!';
                    
                    alert('تم رفع الفيديو بنجاح مع الحماية المزدوجة! 🎉\n\n' +
                          'فيديوك محمي بعلامة مائية حتى موافقة العلامة التجارية وتأكيد الدفع.');
                    
                    // Reset form
                    selectedFile = null;
                    selectedCampaign = null;
                    document.getElementById('videoPreview').classList.add('hidden');
                    document.getElementById('uploadProgress').classList.add('hidden');
                    document.getElementById('videoFile').value = '';
                    document.getElementById('campaignSelect').value = '';
                    updateUploadButton();
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Upload error:', error);
                alert('خطأ في رفع الفيديو: ' + error.message);
                progressDiv.classList.add('hidden');
            }
        }
    </script>

  <!-- Cookie System Integration -->
  <script src="/js/cookie-manager.js"></script>
  <script src="/js/cookie-banner.js"></script>
  <script src="/js/cookie-integration.js"></script>
</body>
</html>
